"use strict";(()=>{var e={};e.id=867,e.ids=[867],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},914:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>E,requestAsyncStorage:()=>w,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>S});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>d,OPTIONS:()=>l,POST:()=>p,PUT:()=>h});var o=r(9303),n=r(8716),a=r(670),i=r(7070),u=r(1926);let c={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"};async function l(){return new i.NextResponse(null,{status:204,headers:c})}async function d(e){try{let t=new URL(e.url),r=t.searchParams.get("action"),s=t.searchParams.get("section"),o=t.searchParams.get("studentId");if("getStudentTotalHours"===r&&o){let e=await (0,u._8)(void 0,o);console.log("Reports for student",o,":",e.length,"reports"),console.log("Report hours:",e.map(e=>({id:e.id,week:e.weekNumber,hours:e.hours})));let t=e.reduce((e,t)=>e+(t.hours||0),0);return console.log("Calculated total hours:",t),i.NextResponse.json({totalHours:t},{headers:c})}let n=await (0,u._8)(s||void 0,o||void 0);return i.NextResponse.json(n,{headers:c})}catch(e){return console.error("Error fetching reports:",e),i.NextResponse.json({error:"Failed to fetch reports: "+e.message},{status:500,headers:c})}}async function p(e){try{let t=await e.json();console.log("Report submitted:",t);let r=await (0,u.Zn)({userName:t.userName||"Unknown",role:t.role||"student",section:t.section||"Unknown",studentId:t.studentId||null,weekNumber:t.weekNumber||1,date:t.date||new Date().toISOString().split("T")[0],hours:t.hours||0,activities:t.activities||"",learnings:t.learnings||""});return i.NextResponse.json({success:!0,message:"Report saved successfully",id:r.id},{headers:c})}catch(e){return console.error("Report error:",e),i.NextResponse.json({error:"Failed to save report: "+e.message},{status:500,headers:c})}}async function h(e){try{let t=await e.json();console.log("Updating report:",t);let{createClient:s}=await Promise.resolve().then(r.bind(r,4738)),o=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL,n=process.env.SUPABASE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY,a=s(o,n);if(t.reportId){let e={};void 0!==t.excuse&&(e.excuse=t.excuse),void 0!==t.date&&(e.date=t.date),void 0!==t.hours&&(e.hours=t.hours),void 0!==t.activities&&(e.activities=t.activities),void 0!==t.learnings&&(e.learnings=t.learnings);let{data:r,error:s}=await a.from("WeeklyReport").update(e).eq("id",t.reportId).select().single();if(s)return console.error("Error updating report:",s),i.NextResponse.json({error:"Failed to update report: "+s.message},{status:500,headers:c});return i.NextResponse.json({success:!0,message:"Report updated successfully",id:r.id},{headers:c})}{let{data:e,error:r}=await a.from("WeeklyReport").insert({userName:"Coordinator Entry",role:"coordinator",section:"N/A",studentId:t.studentId,weekNumber:t.weekNumber,date:t.date||new Date().toISOString().split("T")[0],hours:0,activities:"",learnings:"",excuse:t.excuse}).select().single();if(r)return console.error("Error creating excuse entry:",r),i.NextResponse.json({error:"Failed to create excuse entry: "+r.message},{status:500,headers:c});return i.NextResponse.json({success:!0,message:"Excuse entry created successfully",id:e.id},{headers:c})}}catch(e){return console.error("Error updating report:",e),i.NextResponse.json({error:"Failed to update report: "+e.message},{status:500,headers:c})}}async function g(e){try{let t=new URL(e.url).searchParams.get("id");if(!t)return i.NextResponse.json({error:"Report ID required"},{status:400,headers:c});return console.log("Delete report:",t),await (0,u.GR)(parseInt(t)),i.NextResponse.json({success:!0,message:"Report deleted successfully"},{headers:c})}catch(e){return console.error("Delete error:",e),i.NextResponse.json({error:"Failed to delete report: "+e.message},{status:500,headers:c})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/reports/route",pathname:"/api/reports",filename:"route",bundlePath:"app/api/reports/route"},resolvedPagePath:"C:\\Users\\Admin\\Desktop\\summarize application -Online version\\summarit\\src\\app\\api\\reports\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:S,serverHooks:f}=m,R="/api/reports/route";function E(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:S})}},1926:(e,t,r)=>{r.d(t,{GR:()=>d,LK:()=>u,OQ:()=>a,Zn:()=>l,_8:()=>c,aE:()=>p,sK:()=>i});var s=r(4738);let o=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL,n=process.env.SUPABASE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY,a=(0,s.createClient)(o,n);async function i(e){let{data:t,error:r}=await a.from("StudentEnrollment").select("*").eq("section",e).order("studentId",{ascending:!0});if(r)throw r;return t||[]}async function u(e){let{data:t,error:r}=await a.from("StudentEnrollment").insert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]).select().single();if(r)throw r;return t}async function c(e,t){let r=a.from("WeeklyReport").select("*");e&&(r=r.eq("section",e)),t&&(r=r.eq("studentId",t));let{data:s,error:o}=await r.order("weekNumber",{ascending:!0});if(o)throw o;return s||[]}async function l(e){let{data:t,error:r}=await a.from("WeeklyReport").insert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]).select().single();if(r)throw r;return t}async function d(e){let{error:t}=await a.from("WeeklyReport").delete().eq("id",e);if(t)throw t;return!0}async function p(e){let{data:t,error:r}=await a.from("Coordinator").upsert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],{onConflict:"userName"}).select().single();if(r)throw r;return t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,175],()=>r(914));module.exports=s})();