"use strict";(()=>{var e={};e.id=740,e.ids=[740],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},9814:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{OPTIONS:()=>c,POST:()=>l});var n=r(9303),o=r(8716),a=r(670),i=r(7070),u=r(1926);let d={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"};async function c(){return new i.NextResponse(null,{status:204,headers:d})}async function l(e){try{let{studentId:t,role:r,coordinatorId:s,password:n}=await e.json();if(!r)return i.NextResponse.json({error:"role required"},{status:400,headers:d});if("student"===r){if(!t)return i.NextResponse.json({error:"studentId required"},{status:400,headers:d});try{let{data:e,error:s}=await u.OQ.from("StudentEnrollment").select("*").eq("studentId",t).single();if(s||!e)return i.NextResponse.json({error:"Student is not registered. Please contact the chairman to register your account.",details:"Only students registered by the chairman can access the system."},{status:404,headers:d});if(String(n)!==String(t))return i.NextResponse.json({error:"Invalid password"},{status:401,headers:d});let o=`token-${Math.random().toString(36).slice(2)}`;return i.NextResponse.json({success:!0,token:o,role:r,studentId:t,userName:e.userName,section:e.section,companyName:e.companyName},{headers:d})}catch(e){return console.error("Database error:",e),i.NextResponse.json({error:"Database connection failed. Please try again later.",details:"Unable to verify student registration."},{status:500,headers:d})}}else if("coordinator"===r){if(null==s||isNaN(Number(s)))return i.NextResponse.json({error:"coordinatorId (integer) required"},{status:400,headers:d});if(null==n)return i.NextResponse.json({error:"password required"},{status:400,headers:d});if(String(n)!==String(s))return i.NextResponse.json({error:"Invalid password"},{status:401,headers:d});let{data:e,error:t}=await u.OQ.from("Coordinator").select("userName, sections, approved").eq("coordinatorId",Number(s)).single();if(t||!e||!0!==e.approved)return i.NextResponse.json({error:"Coordinator not found or not approved"},{status:404,headers:d});let o=`token-${Math.random().toString(36).slice(2)}`;return i.NextResponse.json({success:!0,token:o,role:r,userName:e.userName,coordinatorId:Number(s),sections:e.sections},{headers:d})}else{let e=`token-${Math.random().toString(36).slice(2)}`;return i.NextResponse.json({success:!0,token:e,role:r,userName:"Chairman User"},{headers:d})}}catch(e){return console.error("Login error:",e),i.NextResponse.json({error:"Login failed"},{status:500,headers:d})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/login/route",pathname:"/api/login",filename:"route",bundlePath:"app/api/login/route"},resolvedPagePath:"C:\\Users\\Admin\\Desktop\\summarize application -Online version\\summarit\\src\\app\\api\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f}=p,g="/api/login/route";function S(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},1926:(e,t,r)=>{r.d(t,{GR:()=>l,LK:()=>u,OQ:()=>a,Zn:()=>c,_8:()=>d,aE:()=>p,sK:()=>i});var s=r(4738);let n=process.env.SUPABASE_URL||process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.SUPABASE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY,a=(0,s.createClient)(n,o);async function i(e){let{data:t,error:r}=await a.from("StudentEnrollment").select("*").eq("section",e).order("studentId",{ascending:!0});if(r)throw r;return t||[]}async function u(e){let{data:t,error:r}=await a.from("StudentEnrollment").insert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]).select().single();if(r)throw r;return t}async function d(e,t){let r=a.from("WeeklyReport").select("*");e&&(r=r.eq("section",e)),t&&(r=r.eq("studentId",t));let{data:s,error:n}=await r.order("weekNumber",{ascending:!0});if(n)throw n;return s||[]}async function c(e){let{data:t,error:r}=await a.from("WeeklyReport").insert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]).select().single();if(r)throw r;return t}async function l(e){let{error:t}=await a.from("WeeklyReport").delete().eq("id",e);if(t)throw t;return!0}async function p(e){let{data:t,error:r}=await a.from("Coordinator").upsert([{...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],{onConflict:"userName"}).select().single();if(r)throw r;return t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,175],()=>r(9814));module.exports=s})();